-- ============================================================
-- Problem: Exercise 2 - Transaction Management (Banking System)
-- File: BankingSystem.db
-- Tables: accounts, transactions
-- Database: blabz_db
-- ============================================================

mysql> 
USE blabz_db;

Database changed

mysql> 
DROP TABLE IF EXISTS accounts;

Query OK, 0 rows affected, 1 warning (0.07 sec)

mysql> 
DROP TABLE IF EXISTS transactions;

Query OK, 0 rows affected, 1 warning (0.00 sec)

mysql> CREATE TABLE accounts (
    ->     id INT PRIMARY KEY AUTO_INCREMENT,
    ->     name VARCHAR(50),
    ->     balance DECIMAL(10,2)
    -> );
    
Query OK, 0 rows affected (0.07 sec)

mysql> CREATE TABLE transactions (
    ->     id INT PRIMARY KEY AUTO_INCREMENT,
    ->     sender_id INT,
    ->     receiver_id INT,
    ->     amount DECIMAL(10,2),
    ->     date_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    -> );
    
Query OK, 0 rows affected (0.02 sec)

mysql> 
INSERT INTO accounts (name, balance) VALUES ('Vivek', 10000);

Query OK, 1 row affected (0.01 sec)

mysql> 
INSERT INTO accounts (name, balance) VALUES ('Vishaka', 5000);

Query OK, 1 row affected (0.00 sec)

mysql> 
SELECT * FROM accounts;

+----+---------+----------+
| id | name    | balance  |
+----+---------+----------+
|  1 | Vivek   | 10000.00 |
|  2 | Vishaka |  5000.00 |
+----+---------+----------+
2 rows in set (0.01 sec)

/* =================================================
   SECTION 1: TRANSFER MONEY (Vivek → Vishaka ₹2000)
   ================================================= */

mysql> 
START TRANSACTION;

Query OK, 0 rows affected (0.00 sec)

mysql> 
mysql> UPDATE accounts 
    -> SET balance = balance - 2000 
    -> WHERE name = 'Vivek';
    
Query OK, 1 row affected (0.01 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> 
mysql> UPDATE accounts 
    -> SET balance = balance + 2000 
    -> WHERE name = 'Vishaka';
    
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> 
mysql> INSERT INTO transactions (sender_id, receiver_id, amount)
    -> VALUES (1, 2, 2000);
    
Query OK, 1 row affected (0.00 sec)

mysql> 
mysql> COMMIT;

Query OK, 0 rows affected (0.00 sec)

mysql> 
SELECT name, balance FROM accounts;

+---------+---------+
| name    | balance |
+---------+---------+
| Vivek   | 8000.00 |
| Vishaka | 7000.00 |
+---------+---------+
2 rows in set (0.00 sec)

/* =====================================================
    SECTION 2: CHECK BALANCE
   ===================================================== */

mysql> 
SELECT balance FROM accounts WHERE name = 'Vivek';

+---------+
| balance |
+---------+
| 8000.00 |
+---------+
1 row in set (0.00 sec)

/* =====================================================
    SECTION 3: TRANSACTION HISTORY
   ===================================================== */

mysql> 
SELECT * FROM transactions;

+----+-----------+-------------+---------+---------------------+
| id | sender_id | receiver_id | amount  | date_time           |
+----+-----------+-------------+---------+---------------------+
|  1 |         1 |           2 | 2000.00 | 2026-02-09 01:24:13 |
+----+-----------+-------------+---------+---------------------+
1 row in set (0.00 sec)

/* =====================================================
    SECTION 4: ROLLBACK (FAILED / CANCELLED TRANSACTION)
   ===================================================== */

mysql> 
START TRANSACTION;

Query OK, 0 rows affected (0.00 sec)

mysql> UPDATE accounts 
    -> SET balance = balance + 2000 
    -> WHERE id = 1;
    
Query OK, 1 row affected (0.02 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> 
ROLLBACK;

Query OK, 0 rows affected (0.01 sec)

mysql> 
SELECT * FROM accounts WHERE id = 1;

+----+-------+---------+
| id | name  | balance |
+----+-------+---------+
|  1 | Vivek | 8000.00 |
+----+-------+---------+
1 row in set (0.01 sec)

/* =====================================================
   END OF EXERCISE
   Concepts Practiced:
   - Table creation
   - Insert data
   - Transactions (START, COMMIT, ROLLBACK)
   - Balance checking
   - Transaction history
   ===================================================== */